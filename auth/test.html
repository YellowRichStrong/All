<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Login Test - OOPEN AII</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            padding: 40px 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }

        .btn {
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-secondary {
            background: #2196F3;
        }

        .btn-secondary:hover {
            background: #1976D2;
        }

        .status {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .status.not-logged-in {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .status.logged-in {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .user-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-top: 15px;
        }

        .user-info h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .user-detail {
            display: flex;
            margin-bottom: 10px;
        }

        .user-detail strong {
            width: 120px;
            color: #666;
        }

        .user-detail span {
            color: #333;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
        }

        .log {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .log-item {
            margin-bottom: 5px;
            padding: 5px 0;
            border-bottom: 1px solid #37474f;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .log-time {
            color: #64b5f6;
            margin-right: 10px;
        }

        .code-block {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin-top: 10px;
        }

        .instructions {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 6px;
            margin-top: 20px;
        }

        .instructions h4 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Googleç™»å½•åŠŸèƒ½æµ‹è¯•</h1>
            <p>æµ‹è¯•Supabase Google OAuthé›†æˆ</p>
        </div>

        <!-- ç™»å½•çŠ¶æ€ -->
        <div class="section">
            <h2>ç™»å½•çŠ¶æ€</h2>
            <div id="statusDiv" class="status not-logged-in">
                âŒ æœªç™»å½•
            </div>

            <div id="userInfoDiv" style="display:none;">
                <div class="user-info">
                    <img id="userAvatar" class="user-avatar" src="" alt="Avatar">
                    <h3>ç”¨æˆ·ä¿¡æ¯</h3>
                    <div class="user-detail">
                        <strong>é‚®ç®±:</strong>
                        <span id="userEmail"></span>
                    </div>
                    <div class="user-detail">
                        <strong>ç”¨æˆ·ID:</strong>
                        <span id="userId"></span>
                    </div>
                    <div class="user-detail">
                        <strong>Provider:</strong>
                        <span id="userProvider"></span>
                    </div>
                    <div class="user-detail">
                        <strong>åˆ›å»ºæ—¶é—´:</strong>
                        <span id="userCreated"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="section">
            <h2>æ“ä½œ</h2>
            <button class="btn" id="loginBtn">ğŸ”“ Googleç™»å½•</button>
            <button class="btn btn-danger" id="logoutBtn">ğŸ”’ é€€å‡ºç™»å½•</button>
            <button class="btn btn-secondary" id="checkStatusBtn">ğŸ” æ£€æŸ¥çŠ¶æ€</button>
            <button class="btn btn-secondary" id="getSessionBtn">ğŸ“‹ è·å–ä¼šè¯</button>
            <button class="btn btn-secondary" id="clearLogBtn">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="section">
            <h2>ä½¿ç”¨è¯´æ˜</h2>
            <div class="instructions">
                <h4>âš™ï¸ é…ç½®æ­¥éª¤ï¼š</h4>
                <ol>
                    <li>åœ¨Supabase Dashboardä¸­å¯ç”¨Google Provider</li>
                    <li>é…ç½®Google OAuth Client IDå’ŒSecret</li>
                    <li>æ·»åŠ å›è°ƒURL: <code>https://openai2026.com/auth/callback.html</code></li>
                    <li>ç‚¹å‡»ä¸Šæ–¹"Googleç™»å½•"æŒ‰é’®æµ‹è¯•</li>
                </ol>
            </div>

            <div class="code-block">
// å½“å‰é…ç½®<br>
Supabase URL: https://nuvfdstxwxmdobipzlbf.supabase.co<br>
Google Client ID: 524383862092-tut5vno5s2gt1oeb1rkttaj6dhtk1g32.apps.googleusercontent.com<br>
Redirect URL: https://openai2026.com/auth/callback.html
            </div>
        </div>

        <!-- æ—¥å¿— -->
        <div class="section">
            <h2>äº‹ä»¶æ—¥å¿—</h2>
            <div class="log" id="logDiv">
                <div class="log-item">
                    <span class="log-time">[ç­‰å¾…æ“ä½œ]</span>
                    <span>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabaseé…ç½®
        const SUPABASE_URL = 'https://nuvfdstxwxmdobipzlbf.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51dmZkc3R4d3htZG9iaXB6bGJmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMzgxNzgsImV4cCI6MjA3OTYxNDE3OH0.46-tn_DaSzJvnG5NW7PKi_EM9CMk23hD684og6SFjlw';

        // åˆ›å»ºSupabaseå®¢æˆ·ç«¯
        const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // DOMå…ƒç´ 
        const statusDiv = document.getElementById('statusDiv');
        const userInfoDiv = document.getElementById('userInfoDiv');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const checkStatusBtn = document.getElementById('checkStatusBtn');
        const getSessionBtn = document.getElementById('getSessionBtn');
        const clearLogBtn = document.getElementById('clearLogBtn');
        const logDiv = document.getElementById('logDiv');

        // æ—¥å¿—å‡½æ•°
        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.innerHTML = `<span class="log-time">[${time}]</span><span>${message}</span>`;
            logDiv.appendChild(logItem);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Googleç™»å½•
        loginBtn.addEventListener('click', async () => {
            try {
                addLog('ğŸš€ å¼€å§‹Googleç™»å½•æµç¨‹...');
                
                const { data, error } = await client.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: `${window.location.origin}/auth/callback.html`
                    }
                });

                if (error) throw error;
                
                addLog('âœ… ç™»å½•è¯·æ±‚å·²å‘é€ï¼Œæ­£åœ¨è·³è½¬åˆ°Google...');
            } catch (error) {
                addLog(`âŒ ç™»å½•å¤±è´¥: ${error.message}`, 'error');
                console.error('Login error:', error);
            }
        });

        // é€€å‡ºç™»å½•
        logoutBtn.addEventListener('click', async () => {
            try {
                addLog('ğŸ”„ æ­£åœ¨é€€å‡ºç™»å½•...');
                
                const { error } = await client.auth.signOut();
                if (error) throw error;
                
                addLog('âœ… é€€å‡ºç™»å½•æˆåŠŸ');
                updateUI(null);
            } catch (error) {
                addLog(`âŒ é€€å‡ºå¤±è´¥: ${error.message}`, 'error');
                console.error('Logout error:', error);
            }
        });

        // æ£€æŸ¥çŠ¶æ€
        checkStatusBtn.addEventListener('click', async () => {
            try {
                addLog('ğŸ” æ£€æŸ¥ç™»å½•çŠ¶æ€...');
                
                const { data: { user } } = await client.auth.getUser();
                
                if (user) {
                    addLog(`âœ… å·²ç™»å½•: ${user.email}`);
                    updateUI(user);
                } else {
                    addLog('â„¹ï¸ æœªç™»å½•');
                    updateUI(null);
                }
            } catch (error) {
                addLog(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                console.error('Check status error:', error);
            }
        });

        // è·å–ä¼šè¯
        getSessionBtn.addEventListener('click', async () => {
            try {
                addLog('ğŸ“‹ è·å–ä¼šè¯ä¿¡æ¯...');
                
                const { data: { session } } = await client.auth.getSession();
                
                if (session) {
                    addLog(`âœ… ä¼šè¯æœ‰æ•ˆï¼Œè¿‡æœŸæ—¶é—´: ${new Date(session.expires_at * 1000).toLocaleString()}`);
                    console.log('Session:', session);
                } else {
                    addLog('â„¹ï¸ æ— æ´»åŠ¨ä¼šè¯');
                }
            } catch (error) {
                addLog(`âŒ è·å–ä¼šè¯å¤±è´¥: ${error.message}`, 'error');
                console.error('Get session error:', error);
            }
        });

        // æ¸…ç©ºæ—¥å¿—
        clearLogBtn.addEventListener('click', () => {
            logDiv.innerHTML = '<div class="log-item"><span class="log-time">[å·²æ¸…ç©º]</span><span>æ—¥å¿—å·²æ¸…ç©º</span></div>';
        });

        // æ›´æ–°UI
        function updateUI(user) {
            if (user) {
                statusDiv.className = 'status logged-in';
                statusDiv.textContent = 'âœ… å·²ç™»å½•';
                userInfoDiv.style.display = 'block';

                document.getElementById('userEmail').textContent = user.email || '-';
                document.getElementById('userId').textContent = user.id || '-';
                document.getElementById('userProvider').textContent = user.app_metadata?.provider || '-';
                document.getElementById('userCreated').textContent = new Date(user.created_at).toLocaleString() || '-';
                
                const avatarUrl = user.user_metadata?.avatar_url || 
                    `https://ui-avatars.com/api/?name=${encodeURIComponent(user.email)}&background=4CAF50&color=fff`;
                document.getElementById('userAvatar').src = avatarUrl;
            } else {
                statusDiv.className = 'status not-logged-in';
                statusDiv.textContent = 'âŒ æœªç™»å½•';
                userInfoDiv.style.display = 'none';
            }
        }

        // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
        client.auth.onAuthStateChange((event, session) => {
            addLog(`ğŸ“¡ è®¤è¯çŠ¶æ€å˜åŒ–: ${event}`);
            console.log('Auth state change:', event, session);
            
            if (session) {
                updateUI(session.user);
            } else {
                updateUI(null);
            }
        });

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        (async () => {
            addLog('ğŸ¬ é¡µé¢åŠ è½½ï¼Œæ£€æŸ¥ç™»å½•çŠ¶æ€...');
            const { data: { user } } = await client.auth.getUser();
            updateUI(user);
            
            if (user) {
                addLog(`âœ… æ£€æµ‹åˆ°å·²ç™»å½•ç”¨æˆ·: ${user.email}`);
            } else {
                addLog('â„¹ï¸ å½“å‰æœªç™»å½•');
            }
        })();
    </script>
</body>
</html>
