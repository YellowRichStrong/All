<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6486368477427533"
      crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Watermark - OOPEN AII</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="../images/logo.png" type="image/png">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="logo">
                <a href="../index.html">
                    <img src="../images/logo.png" alt="OOPEN AII Logo">
                </a>
                <h1>OOPEN AII</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="../index.html">Image Tools</a></li>
                    <li><a href="../about.html">About</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="tool-container">
                <div class="tool-header">
                    <h2>Image Watermark</h2>
                    <p>Add text or image watermarks to your images</p>
                </div>

                <div class="tool-content">
                    <!-- Upload Section -->
                    <div class="upload-section">
                        <div class="upload-container">
                            <div class="upload-box" id="imageUploadBox">
                                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                                <label for="imageUpload" class="upload-label">
                                    <div class="upload-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#999" viewBox="0 0 16 16">
                                            <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 13a6 6 0 1 1 0-12 6 6 0 0 1 0 12z"/>
                                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                        </svg>
                                    </div>
                                    <p>Drag and drop your image here, or click to select</p>
                                    <p class="upload-hint">Supports JPG, PNG, WebP, and GIF formats</p>
                                </label>
                            </div>
                            <div id="imageInfo" class="image-info" style="display: none;">
                                <div class="image-details">
                                    <span id="fileName"></span>
                                    <span id="fileSize"></span>
                                    <span id="imageDimensions"></span>
                                </div>
                                <button id="changeImageBtn" class="change-btn">Change Image</button>
                            </div>
                        </div>
                    </div>

                    <!-- Watermark Type Selection -->
                    <div class="watermark-type-section">
                        <h3>Watermark Type</h3>
                        <div class="watermark-type-options">
                            <label class="radio-option">
                                <input type="radio" name="watermarkType" value="text" checked>
                                <span>Text Watermark</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="watermarkType" value="image">
                                <span>Image Watermark</span>
                            </label>
                        </div>
                    </div>

                    <!-- Text Watermark Settings -->
                    <div id="textWatermarkSettings" class="settings-section">
                        <h3>Text Watermark Settings</h3>
                        <div class="settings-groups">
                            <div class="settings-group">
                                <div class="setting-item">
                                    <label for="watermarkText">Watermark Text</label>
                                    <input type="text" id="watermarkText" placeholder="Enter watermark text" value="Sample Watermark">
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkFont">Font</label>
                                    <select id="watermarkFont">
                                        <option value="Arial, sans-serif">Arial</option>
                                        <option value="'Times New Roman', serif">Times New Roman</option>
                                        <option value="'Courier New', monospace">Courier New</option>
                                        <option value="Georgia, serif">Georgia</option>
                                        <option value="Verdana, sans-serif">Verdana</option>
                                        <option value="Helvetica, sans-serif">Helvetica</option>
                                        <option value="Impact, sans-serif">Impact</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkSize">Font Size</label>
                                    <div class="range-with-value">
                                        <input type="range" id="watermarkSize" min="10" max="200" value="36">
                                        <span class="range-value">36px</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkColor">Text Color</label>
                                    <div class="color-picker-container">
                                        <input type="color" id="watermarkColor" value="#ffffff">
                                        <input type="text" id="watermarkColorText" value="#ffffff">
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkOpacity">Opacity</label>
                                    <div class="range-with-value">
                                        <input type="range" id="watermarkOpacity" min="0" max="1" step="0.1" value="0.5">
                                        <span class="range-value">50%</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkRotation">Rotation</label>
                                    <div class="range-with-value">
                                        <input type="range" id="watermarkRotation" min="0" max="360" value="45">
                                        <span class="range-value">45Â°</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkStyle">Style</label>
                                    <div class="style-options">
                                        <label class="checkbox-option">
                                            <input type="checkbox" id="watermarkBold">
                                            <span>Bold</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" id="watermarkItalic">
                                            <span>Italic</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" id="watermarkUnderline">
                                            <span>Underline</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkBackground">Background</label>
                                    <div class="color-picker-container">
                                        <input type="color" id="watermarkBackground" value="#000000">
                                        <input type="text" id="watermarkBackgroundText" value="#000000">
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkBackgroundOpacity">Background Opacity</label>
                                    <div class="range-with-value">
                                        <input type="range" id="watermarkBackgroundOpacity" min="0" max="1" step="0.1" value="0">
                                        <span class="range-value">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Image Watermark Settings -->
                    <div id="imageWatermarkSettings" class="settings-section" style="display: none;">
                        <h3>Image Watermark Settings</h3>
                        <div class="settings-groups">
                            <div class="settings-group">
                                <div class="upload-box" id="watermarkImageUploadBox">
                                    <input type="file" id="watermarkImageUpload" accept="image/*" style="display: none;">
                                    <label for="watermarkImageUpload" class="upload-label">
                                        <div class="upload-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#999" viewBox="0 0 16 16">
                                                <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 13a6 6 0 1 1 0-12 6 6 0 0 1 0 12z"/>
                                                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                            </svg>
                                        </div>
                                        <p>Upload your watermark image</p>
                                        <p class="upload-hint">PNG with transparency recommended</p>
                                    </label>
                                </div>
                                
                                <div id="watermarkImageInfo" class="watermark-image-info" style="display: none;">
                                    <div class="watermark-image-preview-container">
                                        <img id="watermarkImagePreview" src="" alt="Watermark Preview">
                                    </div>
                                    <button id="changeWatermarkImageBtn" class="change-btn">Change Watermark</button>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkImageSize">Watermark Size</label>
                                    <div class="range-with-value">
                                        <input type="range" id="watermarkImageSize" min="10" max="100" value="30">
                                        <span class="range-value">30%</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkImageOpacity">Opacity</label>
                                    <div class="range-with-value">
                                        <input type="range" id="watermarkImageOpacity" min="0" max="1" step="0.1" value="0.5">
                                        <span class="range-value">50%</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="watermarkImageRotation">Rotation</label>
                                    <div class="range-with-value">
                                        <input type="range" id="watermarkImageRotation" min="0" max="360" value="0">
                                        <span class="range-value">0Â°</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Position Settings -->
                    <div class="settings-section">
                        <h3>Position & Layout</h3>
                        <div class="settings-groups">
                            <div class="settings-group">
                                <div class="setting-item">
                                    <label>Position</label>
                                    <div class="position-grid">
                                        <button data-position="top-left" class="position-btn active">Top Left</button>
                                        <button data-position="top-center" class="position-btn">Top Center</button>
                                        <button data-position="top-right" class="position-btn">Top Right</button>
                                        <button data-position="center-left" class="position-btn">Center Left</button>
                                        <button data-position="center" class="position-btn">Center</button>
                                        <button data-position="center-right" class="position-btn">Center Right</button>
                                        <button data-position="bottom-left" class="position-btn">Bottom Left</button>
                                        <button data-position="bottom-center" class="position-btn">Bottom Center</button>
                                        <button data-position="bottom-right" class="position-btn">Bottom Right</button>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label>Margins</label>
                                    <div class="margin-controls">
                                        <div class="margin-control">
                                            <label for="marginTop">Top</label>
                                            <input type="number" id="marginTop" value="20">
                                            <span>px</span>
                                        </div>
                                        <div class="margin-control">
                                            <label for="marginRight">Right</label>
                                            <input type="number" id="marginRight" value="20">
                                            <span>px</span>
                                        </div>
                                        <div class="margin-control">
                                            <label for="marginBottom">Bottom</label>
                                            <input type="number" id="marginBottom" value="20">
                                            <span>px</span>
                                        </div>
                                        <div class="margin-control">
                                            <label for="marginLeft">Left</label>
                                            <input type="number" id="marginLeft" value="20">
                                            <span>px</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label class="checkbox-option">
                                        <input type="checkbox" id="tileWatermark">
                                        <span>Tile watermark across the image</span>
                                    </label>
                                </div>
                                
                                <div class="setting-item" id="tileSpacingContainer">
                                    <label for="tileSpacing">Tile Spacing</label>
                                    <div class="range-with-value">
                                        <input type="range" id="tileSpacing" min="10" max="100" value="40">
                                        <span class="range-value">40px</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Preview Section -->
                    <div class="preview-section">
                        <h3>Preview</h3>
                        <div class="preview-container">
                            <div id="previewWrapper" class="preview-wrapper">
                                <div id="imagePreviewContainer" class="image-preview-container">
                                    <img id="imagePreview" src="" alt="Preview" style="display: none;">
                                    <canvas id="previewCanvas" style="display: none;"></canvas>
                                    <div id="noImageMessage" class="no-image-message">
                                        <p>Upload an image to see the preview</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Output Settings -->
                    <div class="settings-section">
                        <h3>Output Settings</h3>
                        <div class="settings-groups">
                            <div class="settings-group">
                                <div class="setting-item">
                                    <label for="outputFormat">Output Format</label>
                                    <select id="outputFormat">
                                        <option value="png">PNG</option>
                                        <option value="jpeg">JPEG</option>
                                        <option value="webp">WebP</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="outputQuality">Quality</label>
                                    <div class="range-with-value">
                                        <input type="range" id="outputQuality" min="0.1" max="1" step="0.1" value="0.9">
                                        <span class="range-value">90%</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="outputFileName">File Name</label>
                                    <input type="text" id="outputFileName" placeholder="Enter output file name">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button id="applyWatermarkBtn" class="action-btn" disabled>Apply Watermark</button>
                        <button id="resetBtn" class="action-btn" disabled>Reset</button>
                        <a id="downloadBtn" class="action-btn download-btn" download disabled>Download</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="../pages/contact.html">Contact Us</a>
                <a href="../pages/privacy.html">Privacy Policy</a>
                <a href="../pages/terms.html">User Rights</a>
            </div>
            <div class="copyright">
                <p>&copy; 2026 OOPEN AII. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Main elements
            const imageUploadBox = document.getElementById('imageUploadBox');
            const imageUpload = document.getElementById('imageUpload');
            const imageInfo = document.getElementById('imageInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const imageDimensions = document.getElementById('imageDimensions');
            const changeImageBtn = document.getElementById('changeImageBtn');
            
            // Watermark type selection
            const watermarkTypeOptions = document.querySelectorAll('input[name="watermarkType"]');
            const textWatermarkSettings = document.getElementById('textWatermarkSettings');
            const imageWatermarkSettings = document.getElementById('imageWatermarkSettings');
            
            // Text watermark settings
            const watermarkText = document.getElementById('watermarkText');
            const watermarkFont = document.getElementById('watermarkFont');
            const watermarkSize = document.getElementById('watermarkSize');
            const watermarkColor = document.getElementById('watermarkColor');
            const watermarkColorText = document.getElementById('watermarkColorText');
            const watermarkOpacity = document.getElementById('watermarkOpacity');
            const watermarkRotation = document.getElementById('watermarkRotation');
            const watermarkBold = document.getElementById('watermarkBold');
            const watermarkItalic = document.getElementById('watermarkItalic');
            const watermarkUnderline = document.getElementById('watermarkUnderline');
            const watermarkBackground = document.getElementById('watermarkBackground');
            const watermarkBackgroundText = document.getElementById('watermarkBackgroundText');
            const watermarkBackgroundOpacity = document.getElementById('watermarkBackgroundOpacity');
            
            // Image watermark settings
            const watermarkImageUploadBox = document.getElementById('watermarkImageUploadBox');
            const watermarkImageUpload = document.getElementById('watermarkImageUpload');
            const watermarkImageInfo = document.getElementById('watermarkImageInfo');
            const watermarkImagePreview = document.getElementById('watermarkImagePreview');
            const changeWatermarkImageBtn = document.getElementById('changeWatermarkImageBtn');
            const watermarkImageSize = document.getElementById('watermarkImageSize');
            const watermarkImageOpacity = document.getElementById('watermarkImageOpacity');
            const watermarkImageRotation = document.getElementById('watermarkImageRotation');
            
            // Position settings
            const positionBtns = document.querySelectorAll('.position-btn');
            const marginTop = document.getElementById('marginTop');
            const marginRight = document.getElementById('marginRight');
            const marginBottom = document.getElementById('marginBottom');
            const marginLeft = document.getElementById('marginLeft');
            const tileWatermark = document.getElementById('tileWatermark');
            const tileSpacingContainer = document.getElementById('tileSpacingContainer');
            const tileSpacing = document.getElementById('tileSpacing');
            
            // Preview elements
            const previewWrapper = document.getElementById('previewWrapper');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            const imagePreview = document.getElementById('imagePreview');
            const previewCanvas = document.getElementById('previewCanvas');
            const noImageMessage = document.getElementById('noImageMessage');
            
            // Output settings
            const outputFormat = document.getElementById('outputFormat');
            const outputQuality = document.getElementById('outputQuality');
            const outputFileName = document.getElementById('outputFileName');
            
            // Action buttons
            const applyWatermarkBtn = document.getElementById('applyWatermarkBtn');
            const resetBtn = document.getElementById('resetBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            // Range values
            const rangeValues = document.querySelectorAll('.range-value');
            
            // Store image data
            let uploadedImage = null;
            let watermarkImage = null;
            let processedImageUrl = null;
            
            // Initialize event listeners
            initEventListeners();
            
            function initEventListeners() {
                // Image upload handling
                imageUploadBox.addEventListener('dragover', handleDragOver);
                imageUploadBox.addEventListener('dragleave', handleDragLeave);
                imageUploadBox.addEventListener('drop', handleDrop);
                imageUpload.addEventListener('change', handleImageSelect);
                changeImageBtn.addEventListener('click', function() {
                    imageUpload.click();
                });
                
                // Watermark type selection
                watermarkTypeOptions.forEach(option => {
                    option.addEventListener('change', function() {
                        textWatermarkSettings.style.display = this.value === 'text' ? 'block' : 'none';
                        imageWatermarkSettings.style.display = this.value === 'image' ? 'block' : 'none';
                        updatePreview();
                    });
                });
                
                // Text watermark settings events
                watermarkText.addEventListener('input', updatePreview);
                watermarkFont.addEventListener('change', updatePreview);
                watermarkSize.addEventListener('input', function() {
                    updateRangeValue.call(this, 'px');
                    updatePreview();
                });
                watermarkColor.addEventListener('input', function() {
                    watermarkColorText.value = this.value;
                    updatePreview();
                });
                watermarkColorText.addEventListener('input', function() {
                    if (/^#([0-9A-F]{3}){1,2}$/i.test(this.value)) {
                        watermarkColor.value = this.value;
                        updatePreview();
                    }
                });
                watermarkOpacity.addEventListener('input', function() {
                    updateRangeValue.call(this, '%', 100);
                    updatePreview();
                });
                watermarkRotation.addEventListener('input', function() {
                    updateRangeValue.call(this, 'Â°');
                    updatePreview();
                });
                watermarkBold.addEventListener('change', updatePreview);
                watermarkItalic.addEventListener('change', updatePreview);
                watermarkUnderline.addEventListener('change', updatePreview);
                watermarkBackground.addEventListener('input', function() {
                    watermarkBackgroundText.value = this.value;
                    updatePreview();
                });
                watermarkBackgroundText.addEventListener('input', function() {
                    if (/^#([0-9A-F]{3}){1,2}$/i.test(this.value)) {
                        watermarkBackground.value = this.value;
                        updatePreview();
                    }
                });
                watermarkBackgroundOpacity.addEventListener('input', function() {
                    updateRangeValue.call(this, '%', 100);
                    updatePreview();
                });
                
                // Image watermark upload handling
                watermarkImageUploadBox.addEventListener('dragover', handleDragOver);
                watermarkImageUploadBox.addEventListener('dragleave', handleDragLeave);
                watermarkImageUploadBox.addEventListener('drop', function(e) {
                    e.preventDefault();
                    watermarkImageUploadBox.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length > 0) {
                        handleWatermarkImageSelect({ target: { files: e.dataTransfer.files } });
                    }
                });
                watermarkImageUpload.addEventListener('change', handleWatermarkImageSelect);
                changeWatermarkImageBtn.addEventListener('click', function() {
                    watermarkImageUpload.click();
                });
                
                // Image watermark settings events
                watermarkImageSize.addEventListener('input', function() {
                    updateRangeValue.call(this, '%');
                    updatePreview();
                });
                watermarkImageOpacity.addEventListener('input', function() {
                    updateRangeValue.call(this, '%', 100);
                    updatePreview();
                });
                watermarkImageRotation.addEventListener('input', function() {
                    updateRangeValue.call(this, 'Â°');
                    updatePreview();
                });
                
                // Position settings events
                positionBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        positionBtns.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        updatePreview();
                    });
                });
                marginTop.addEventListener('input', updatePreview);
                marginRight.addEventListener('input', updatePreview);
                marginBottom.addEventListener('input', updatePreview);
                marginLeft.addEventListener('input', updatePreview);
                tileWatermark.addEventListener('change', function() {
                    tileSpacingContainer.style.display = this.checked ? 'block' : 'none';
                    updatePreview();
                });
                tileSpacing.addEventListener('input', function() {
                    updateRangeValue.call(this, 'px');
                    updatePreview();
                });
                
                // Output settings events
                outputFormat.addEventListener('change', updateDownloadLink);
                outputQuality.addEventListener('input', function() {
                    updateRangeValue.call(this, '%', 100);
                });
                outputFileName.addEventListener('input', updateDownloadLink);
                
                // Action buttons events
                applyWatermarkBtn.addEventListener('click', applyWatermark);
                resetBtn.addEventListener('click', resetAll);
                
                // Initialize range values
                updateRangeValue.call(watermarkSize, 'px');
                updateRangeValue.call(watermarkOpacity, '%', 100);
                updateRangeValue.call(watermarkRotation, 'Â°');
                updateRangeValue.call(watermarkBackgroundOpacity, '%', 100);
                updateRangeValue.call(watermarkImageSize, '%');
                updateRangeValue.call(watermarkImageOpacity, '%', 100);
                updateRangeValue.call(watermarkImageRotation, 'Â°');
                updateRangeValue.call(outputQuality, '%', 100);
                updateRangeValue.call(tileSpacing, 'px');
                
                // Initialize tile spacing container
                tileSpacingContainer.style.display = tileWatermark.checked ? 'block' : 'none';
            }
            
            function handleDragOver(e) {
                e.preventDefault();
                this.classList.add('dragover');
            }
            
            function handleDragLeave() {
                this.classList.remove('dragover');
            }
            
            function handleDrop(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                
                if (e.dataTransfer.files.length > 0) {
                    handleImageSelect({ target: { files: e.dataTransfer.files } });
                }
            }
            
            function handleImageSelect(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // Check file type
                if (!file.type.match('image.*')) {
                    Utils.showNotification('Please select an image file!', 'warning');
                    return;
                }
                
                // Read file
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        // Store image data
                        uploadedImage = {
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            width: img.width,
                            height: img.height,
                            src: e.target.result
                        };
                        
                        // Update UI
                        imagePreview.src = e.target.result;
                        imagePreview.style.display = 'block';
                        previewCanvas.style.display = 'none';
                        noImageMessage.style.display = 'none';
                        
                        // Update image info
                        fileName.textContent = file.name;
                        fileSize.textContent = formatFileSize(file.size);
                        imageDimensions.textContent = `${img.width} Ã ${img.height}`;
                        imageInfo.style.display = 'flex';
                        
                        // Set default output file name
                        const nameWithoutExt = file.name.replace(/\.[^/.]+$/, '');
                        outputFileName.value = `${nameWithoutExt}_watermark`;
                        
                        // Enable buttons
                        applyWatermarkBtn.disabled = false;
                        resetBtn.disabled = false;
                        
                        // Update preview
                        updatePreview();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            function handleWatermarkImageSelect(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // Check file type
                if (!file.type.match('image.*')) {
                    Utils.showNotification('Please select an image file!', 'warning');
                    return;
                }
                
                // Read file
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        // Store watermark image data
                        watermarkImage = {
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            width: img.width,
                            height: img.height,
                            src: e.target.result
                        };
                        
                        // Update UI
                        watermarkImagePreview.src = e.target.result;
                        watermarkImageInfo.style.display = 'block';
                        
                        // Update preview
                        updatePreview();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            function updateRangeValue(suffix = '', multiplier = 1) {
                const value = this.value * multiplier;
                // Find the corresponding range value display
                const rangeValues = document.querySelectorAll('.range-value');
                let targetValue;
                
                if (this === watermarkSize) targetValue = rangeValues[0];
                else if (this === watermarkOpacity) targetValue = rangeValues[1];
                else if (this === watermarkRotation) targetValue = rangeValues[2];
                else if (this === watermarkBackgroundOpacity) targetValue = rangeValues[3];
                else if (this === watermarkImageSize) targetValue = rangeValues[4];
                else if (this === watermarkImageOpacity) targetValue = rangeValues[5];
                else if (this === watermarkImageRotation) targetValue = rangeValues[6];
                else if (this === outputQuality) targetValue = rangeValues[7];
                else if (this === tileSpacing) targetValue = rangeValues[8];
                
                if (targetValue) {
                    targetValue.textContent = `${value}${suffix}`;
                }
            }
            
            function updatePreview() {
                if (!uploadedImage) return;
                
                // Set up canvas
                const ctx = previewCanvas.getContext('2d');
                const canvasWidth = uploadedImage.width;
                const canvasHeight = uploadedImage.height;
                
                // Set canvas dimensions
                previewCanvas.width = canvasWidth;
                previewCanvas.height = canvasHeight;
                
                // Draw original image
                const img = new Image();
                img.onload = function() {
                    ctx.drawImage(img, 0, 0, canvasWidth, canvasHeight);
                    
                    // Draw watermark based on selected type
                    const watermarkType = document.querySelector('input[name="watermarkType"]:checked').value;
                    
                    if (watermarkType === 'text') {
                        drawTextWatermark(ctx, canvasWidth, canvasHeight);
                    } else {
                        drawImageWatermark(ctx, canvasWidth, canvasHeight);
                    }
                    
                    // Show canvas, hide original image
                    imagePreview.style.display = 'none';
                    previewCanvas.style.display = 'block';
                };
                img.src = uploadedImage.src;
            }
            
            function drawTextWatermark(ctx, canvasWidth, canvasHeight) {
                const text = watermarkText.value;
                if (!text) return;
                
                // Get text properties
                const font = watermarkFont.value;
                const fontSize = parseInt(watermarkSize.value);
                const fontWeight = watermarkBold.checked ? 'bold' : 'normal';
                const fontStyle = watermarkItalic.checked ? 'italic' : 'normal';
                const textDecoration = watermarkUnderline.checked ? 'underline' : 'none';
                const textColor = watermarkColor.value;
                const textOpacity = parseFloat(watermarkOpacity.value);
                const rotation = parseFloat(watermarkRotation.value);
                const bgColor = watermarkBackground.value;
                const bgOpacity = parseFloat(watermarkBackgroundOpacity.value);
                
                // Set font
                ctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${font}`;
                ctx.textBaseline = 'middle';
                ctx.textAlign = 'center';
                
                // Measure text
                const textMetrics = ctx.measureText(text);
                const textWidth = textMetrics.width;
                const textHeight = fontSize;
                
                // Get margins
                const margins = {
                    top: parseInt(marginTop.value),
                    right: parseInt(marginRight.value),
                    bottom: parseInt(marginBottom.value),
                    left: parseInt(marginLeft.value)
                };
                
                if (tileWatermark.checked) {
                    // Draw tiled watermarks
                    const spacing = parseInt(tileSpacing.value);
                    const diagonal = Math.sqrt(canvasWidth * canvasWidth + canvasHeight * canvasHeight);
                    
                    ctx.save();
                    ctx.translate(canvasWidth / 2, canvasHeight / 2);
                    ctx.rotate((rotation * Math.PI) / 180);
                    
                    // Calculate number of tiles needed
                    const tilesX = Math.ceil(diagonal / (textWidth + spacing));
                    const tilesY = Math.ceil(diagonal / (textHeight + spacing));
                    
                    // Draw tiles
                    for (let y = -tilesY; y <= tilesY; y++) {
                        for (let x = -tilesX; x <= tilesX; x++) {
                            const xPos = x * (textWidth + spacing);
                            const yPos = y * (textHeight + spacing);
                            
                            // Draw background if needed
                            if (bgOpacity > 0) {
                                ctx.save();
                                ctx.fillStyle = bgColor;
                                ctx.globalAlpha = bgOpacity;
                                ctx.fillRect(xPos - textWidth / 2 - 5, yPos - fontSize / 2 - 2, textWidth + 10, fontSize + 4);
                                ctx.restore();
                            }
                            
                            // Draw text
                            ctx.save();
                            ctx.fillStyle = textColor;
                            ctx.globalAlpha = textOpacity;
                            ctx.fillText(text, xPos, yPos);
                            
                            // Draw underline if needed
                            if (watermarkUnderline.checked) {
                                ctx.beginPath();
                                ctx.moveTo(xPos - textWidth / 2, yPos + fontSize / 2);
                                ctx.lineTo(xPos + textWidth / 2, yPos + fontSize / 2);
                                ctx.stroke();
                            }
                            
                            ctx.restore();
                        }
                    }
                    
                    ctx.restore();
                } else {
                    // Get position
                    const position = document.querySelector('.position-btn.active').dataset.position;
                    
                    // Calculate position
                    let x, y;
                    switch(position) {
                        case 'top-left':
                            x = margins.left + textWidth / 2;
                            y = margins.top + textHeight / 2;
                            ctx.textAlign = 'left';
                            break;
                        case 'top-center':
                            x = canvasWidth / 2;
                            y = margins.top + textHeight / 2;
                            ctx.textAlign = 'center';
                            break;
                        case 'top-right':
                            x = canvasWidth - margins.right - textWidth / 2;
                            y = margins.top + textHeight / 2;
                            ctx.textAlign = 'right';
                            break;
                        case 'center-left':
                            x = margins.left + textWidth / 2;
                            y = canvasHeight / 2;
                            ctx.textAlign = 'left';
                            break;
                        case 'center':
                            x = canvasWidth / 2;
                            y = canvasHeight / 2;
                            ctx.textAlign = 'center';
                            break;
                        case 'center-right':
                            x = canvasWidth - margins.right - textWidth / 2;
                            y = canvasHeight / 2;
                            ctx.textAlign = 'right';
                            break;
                        case 'bottom-left':
                            x = margins.left + textWidth / 2;
                            y = canvasHeight - margins.bottom - textHeight / 2;
                            ctx.textAlign = 'left';
                            break;
                        case 'bottom-center':
                            x = canvasWidth / 2;
                            y = canvasHeight - margins.bottom - textHeight / 2;
                            ctx.textAlign = 'center';
                            break;
                        case 'bottom-right':
                            x = canvasWidth - margins.right - textWidth / 2;
                            y = canvasHeight - margins.bottom - textHeight / 2;
                            ctx.textAlign = 'right';
                            break;
                    }
                    
                    // Apply rotation
                    ctx.save();
                    ctx.translate(x, y);
                    ctx.rotate((rotation * Math.PI) / 180);
                    
                    // Draw background if needed
                    if (bgOpacity > 0) {
                        ctx.save();
                        ctx.fillStyle = bgColor;
                        ctx.globalAlpha = bgOpacity;
                        ctx.fillRect(-textWidth / 2 - 5, -fontSize / 2 - 2, textWidth + 10, fontSize + 4);
                        ctx.restore();
                    }
                    
                    // Draw text
                    ctx.fillStyle = textColor;
                    ctx.globalAlpha = textOpacity;
                    ctx.fillText(text, 0, 0);
                    
                    // Draw underline if needed
                    if (watermarkUnderline.checked) {
                        ctx.beginPath();
                        ctx.moveTo(-textWidth / 2, fontSize / 2);
                        ctx.lineTo(textWidth / 2, fontSize / 2);
                        ctx.stroke();
                    }
                    
                    ctx.restore();
                }
            }
            
            function drawImageWatermark(ctx, canvasWidth, canvasHeight) {
                if (!watermarkImage) return;
                
                // Get watermark properties
                const opacity = parseFloat(watermarkImageOpacity.value);
                const rotation = parseFloat(watermarkImageRotation.value);
                const sizePercentage = parseInt(watermarkImageSize.value) / 100;
                
                // Calculate watermark dimensions
                const watermarkWidth = watermarkImage.width * sizePercentage;
                const watermarkHeight = watermarkImage.height * sizePercentage;
                
                // Get margins
                const margins = {
                    top: parseInt(marginTop.value),
                    right: parseInt(marginRight.value),
                    bottom: parseInt(marginBottom.value),
                    left: parseInt(marginLeft.value)
                };
                
                // Create watermark image
                const img = new Image();
                img.onload = function() {
                    if (tileWatermark.checked) {
                        // Draw tiled watermarks
                        const spacing = parseInt(tileSpacing.value);
                        const diagonal = Math.sqrt(canvasWidth * canvasWidth + canvasHeight * canvasHeight);
                        
                        ctx.save();
                        ctx.translate(canvasWidth / 2, canvasHeight / 2);
                        ctx.rotate((rotation * Math.PI) / 180);
                        ctx.globalAlpha = opacity;
                        
                        // Calculate number of tiles needed
                        const tilesX = Math.ceil(diagonal / (watermarkWidth + spacing));
                        const tilesY = Math.ceil(diagonal / (watermarkHeight + spacing));
                        
                        // Draw tiles
                        for (let y = -tilesY; y <= tilesY; y++) {
                            for (let x = -tilesX; x <= tilesX; x++) {
                                const xPos = x * (watermarkWidth + spacing);
                                const yPos = y * (watermarkHeight + spacing);
                                
                                ctx.drawImage(img, xPos - watermarkWidth / 2, yPos - watermarkHeight / 2, watermarkWidth, watermarkHeight);
                            }
                        }
                        
                        ctx.restore();
                    } else {
                        // Get position
                        const position = document.querySelector('.position-btn.active').dataset.position;
                        
                        // Calculate position
                        let x, y;
                        switch(position) {
                            case 'top-left':
                                x = margins.left + watermarkWidth / 2;
                                y = margins.top + watermarkHeight / 2;
                                break;
                            case 'top-center':
                                x = canvasWidth / 2;
                                y = margins.top + watermarkHeight / 2;
                                break;
                            case 'top-right':
                                x = canvasWidth - margins.right - watermarkWidth / 2;
                                y = margins.top + watermarkHeight / 2;
                                break;
                            case 'center-left':
                                x = margins.left + watermarkWidth / 2;
                                y = canvasHeight / 2;
                                break;
                            case 'center':
                                x = canvasWidth / 2;
                                y = canvasHeight / 2;
                                break;
                            case 'center-right':
                                x = canvasWidth - margins.right - watermarkWidth / 2;
                                y = canvasHeight / 2;
                                break;
                            case 'bottom-left':
                                x = margins.left + watermarkWidth / 2;
                                y = canvasHeight - margins.bottom - watermarkHeight / 2;
                                break;
                            case 'bottom-center':
                                x = canvasWidth / 2;
                                y = canvasHeight - margins.bottom - watermarkHeight / 2;
                                break;
                            case 'bottom-right':
                                x = canvasWidth - margins.right - watermarkWidth / 2;
                                y = canvasHeight - margins.bottom - watermarkHeight / 2;
                                break;
                        }
                        
                        // Draw watermark image
                        ctx.save();
                        ctx.translate(x, y);
                        ctx.rotate((rotation * Math.PI) / 180);
                        ctx.globalAlpha = opacity;
                        ctx.drawImage(img, -watermarkWidth / 2, -watermarkHeight / 2, watermarkWidth, watermarkHeight);
                        ctx.restore();
                    }
                };
                img.src = watermarkImage.src;
            }
            
            function applyWatermark() {
                if (!uploadedImage) return;
                
                // Create a new canvas for the final image
                const finalCanvas = document.createElement('canvas');
                const finalCtx = finalCanvas.getContext('2d');
                
                // Set canvas dimensions
                finalCanvas.width = uploadedImage.width;
                finalCanvas.height = uploadedImage.height;
                
                // Draw the image with watermark from the preview canvas
                finalCtx.drawImage(previewCanvas, 0, 0);
                
                // Convert to data URL with selected format and quality
                const format = outputFormat.value;
                const quality = parseFloat(outputQuality.value);
                let mimeType = `image/${format}`;
                
                processedImageUrl = finalCanvas.toDataURL(mimeType, quality);
                
                // Update download link
                updateDownloadLink();
                
                // Show success notification
                Utils.showNotification('Watermark applied successfully!');
            }
            
            function updateDownloadLink() {
                if (!processedImageUrl) return;
                
                // Set download URL
                downloadBtn.href = processedImageUrl;
                
                // Set download filename
                let filename = outputFileName.value || 'watermarked_image';
                const format = outputFormat.value;
                
                // Ensure filename has correct extension
                if (!filename.endsWith(`.${format}`)) {
                    filename += `.${format}`;
                }
                
                downloadBtn.download = filename;
                
                // Enable download button
                downloadBtn.disabled = false;
            }
            
            function resetAll() {
                // Reset image
                uploadedImage = null;
                watermarkImage = null;
                processedImageUrl = null;
                
                // Reset UI
                imagePreview.src = '';
                imagePreview.style.display = 'none';
                previewCanvas.style.display = 'none';
                noImageMessage.style.display = 'block';
                imageInfo.style.display = 'none';
                watermarkImagePreview.src = '';
                watermarkImageInfo.style.display = 'none';
                
                // Reset form values
                watermarkText.value = 'Sample Watermark';
                watermarkFont.selectedIndex = 0;
                watermarkSize.value = 36;
                watermarkColor.value = '#ffffff';
                watermarkColorText.value = '#ffffff';
                watermarkOpacity.value = 0.5;
                watermarkRotation.value = 45;
                watermarkBold.checked = false;
                watermarkItalic.checked = false;
                watermarkUnderline.checked = false;
                watermarkBackground.value = '#000000';
                watermarkBackgroundText.value = '#000000';
                watermarkBackgroundOpacity.value = 0;
                watermarkImageSize.value = 30;
                watermarkImageOpacity.value = 0.5;
                watermarkImageRotation.value = 0;
                
                // Reset position
                positionBtns.forEach(btn => btn.classList.remove('active'));
                document.querySelector('[data-position="top-left"]').classList.add('active');
                marginTop.value = 20;
                marginRight.value = 20;
                marginBottom.value = 20;
                marginLeft.value = 20;
                tileWatermark.checked = false;
                tileSpacing.value = 40;
                tileSpacingContainer.style.display = 'none';
                
                // Reset output
                outputFormat.selectedIndex = 0;
                outputQuality.value = 0.9;
                outputFileName.value = '';
                
                // Reset range values
                updateRangeValue.call(watermarkSize, 'px');
                updateRangeValue.call(watermarkOpacity, '%', 100);
                updateRangeValue.call(watermarkRotation, 'Â°');
                updateRangeValue.call(watermarkBackgroundOpacity, '%', 100);
                updateRangeValue.call(watermarkImageSize, '%');
                updateRangeValue.call(watermarkImageOpacity, '%', 100);
                updateRangeValue.call(watermarkImageRotation, 'Â°');
                updateRangeValue.call(outputQuality, '%', 100);
                updateRangeValue.call(tileSpacing, 'px');
                
                // Disable buttons
                applyWatermarkBtn.disabled = true;
                resetBtn.disabled = true;
                downloadBtn.disabled = true;
                downloadBtn.href = '#';
                
                // Show notification
                Utils.showNotification('All settings reset!');
            }
            
            // Helper functions
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        });
    </script>
    <style>
        .upload-section {
            margin-bottom: 30px;
        }
        
        .upload-container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .upload-box {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            background-color: #f9f9f9;
        }
        
        .upload-box.dragover {
            border-color: #3498db;
            background-color: #e8f4fd;
        }
        
        .upload-label {
            display: block;
            cursor: pointer;
        }
        
        .upload-icon {
            margin-bottom: 20px;
        }
        
        .upload-box p {
            margin: 10px 0;
            color: #666;
        }
        
        .upload-hint {
            font-size: 14px;
            color: #999;
        }
        
        .image-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding: 12px 16px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        
        .image-details {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #666;
        }
        
        .change-btn {
            padding: 6px 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .change-btn:hover {
            background-color: #2980b9;
        }
        
        .watermark-type-section {
            margin-bottom: 30px;
        }
        
        .watermark-type-options {
            display: flex;
            gap: 20px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .radio-option:hover {
            border-color: #3498db;
            background-color: #f0f8ff;
        }
        
        .radio-option input[type="radio"] {
            cursor: pointer;
        }
        
        .settings-section {
            margin-bottom: 30px;
        }
        
        .settings-groups {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .settings-group {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
        }
        
        .setting-item {
            margin-bottom: 20px;
        }
        
        .setting-item:last-child {
            margin-bottom: 0;
        }
        
        .setting-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .setting-item input[type="text"],
        .setting-item input[type="number"],
        .setting-item select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .setting-item input[type="number"] {
            width: 80px;
        }
        
        .range-with-value {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .range-with-value input[type="range"] {
            flex: 1;
        }
        
        .range-with-value .range-value {
            min-width: 50px;
            text-align: right;
            font-weight: bold;
        }
        
        .color-picker-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .color-picker-container input[type="color"] {
            width: 50px;
            height: 40px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .color-picker-container input[type="text"] {
            flex: 1;
            max-width: 120px;
        }
        
        .style-options {
            display: flex;
            gap: 20px;
        }
        
        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .checkbox-option input[type="checkbox"] {
            cursor: pointer;
        }
        
        .watermark-image-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .watermark-image-preview-container {
            width: 100px;
            height: 100px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
        }
        
        .watermark-image-preview-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .position-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .position-btn {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .position-btn:hover {
            background-color: #f0f0f0;
        }
        
        .position-btn.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .margin-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .margin-control {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .margin-control label {
            font-size: 14px;
            font-weight: normal;
        }
        
        .margin-control input[type="number"] {
            width: 100%;
        }
        
        .margin-control span {
            font-size: 12px;
            color: #666;
            margin-top: -5px;
        }
        
        .preview-section {
            margin-bottom: 30px;
        }
        
        .preview-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }
        
        .preview-wrapper {
            max-width: 100%;
            max-height: 600px;
            overflow: auto;
        }
        
        .image-preview-container {
            position: relative;
            display: inline-block;
        }
        
        .image-preview-container img,
        .image-preview-container canvas {
            max-width: 100%;
            max-height: 600px;
            object-fit: contain;
            border-radius: 4px;
        }
        
        .no-image-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #999;
            font-size: 18px;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        #applyWatermarkBtn {
            background-color: #3498db;
            color: white;
        }
        
        #applyWatermarkBtn:hover:not(:disabled) {
            background-color: #2980b9;
        }
        
        #resetBtn {
            background-color: #e74c3c;
            color: white;
        }
        
        #resetBtn:hover:not(:disabled) {
            background-color: #c0392b;
        }
        
        .download-btn {
            background-color: #27ae60;
            color: white;
        }
        
        .download-btn:hover:not(:disabled) {
            background-color: #229954;
        }
        
        @media (max-width: 768px) {
            .watermark-type-options {
                flex-direction: column;
            }
            
            .color-picker-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .color-picker-container input[type="color"] {
                width: 100%;
            }
            
            .style-options {
                flex-direction: column;
                gap: 10px;
            }
            
            .watermark-image-info {
                flex-direction: column;
                align-items: stretch;
            }
            
            .watermark-image-preview-container {
                width: 100%;
                max-width: 200px;
                margin: 0 auto;
            }
            
            .margin-controls {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</body>
</html>