<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6486368477427533"
      crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Stitching Tool - OOPEN AII</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="../images/logo.png" type="image/png">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="logo">
                <a href="../index.html">
                    <img src="../images/logo.png" alt="OOPEN AII Logo">
                </a>
                <h1>OOPEN AII</h1>
            </div>
            <nav>
                <ul>
                    <li class="active"><a href="../index.html">Image Tools</a></li>
                    <li><a href="../encry.html">Encry Tools</a></li>
                    <li><a href="../code.html" style="display:block !important;">Code Tools</a></li>
                    <li><a href="../network.html">Network Tools</a></li>
                    <li><a href="../dav.html">Dav</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="breadcrumb">
                <a href="../index.html">index</a> &gt; 
                <a href="../index.html">Image Tools</a> &gt; 
                <span>Image Stitching</span>
            </div>
            <div class="tool-container">
                <div class="tool-header">
                    <h2>Image Stitching Tool</h2>
                    <p>Combine multiple images horizontally or vertically</p>
                </div>

                <div class="tool-content">
                    <!-- Upload Area -->
                    <div class="upload-area" id="uploadArea">
                        <input type="file" id="imageUpload" accept="image/*" multiple>
                        <div class="upload-icon">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                            </svg>
                        </div>
                        <p>Drag and drop images here, or</p>
                        <button class="upload-btn" onclick="document.getElementById('imageUpload').click()">Select Images</button>
                        <p class="upload-hint">Supports multiple images</p>
                    </div>

                    <!-- Options -->
                    <div class="options">
                        <div class="option-row">
                            <div class="option-group">
                                <label>Stitch Direction</label>
                                <div class="direction-buttons">
                                    <label>
                                        <input type="radio" name="direction" value="horizontal" checked>
                                        <span class="direction-label">Horizontal</span>
                                    </label>
                                    <label>
                                        <input type="radio" name="direction" value="vertical">
                                        <span class="direction-label">Vertical</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="option-group">
                                <label for="gap">Gap Size</label>
                                <input type="range" id="gap" min="0" max="50" value="0">
                                <span id="gapValue">0px</span>
                            </div>
                        </div>

                        <div class="option-row">
                            <div class="option-group">
                                <label for="backgroundColor">Background Color</label>
                                <div class="color-input-group">
                                    <input type="color" id="backgroundColor" value="#ffffff">
                                    <input type="text" id="backgroundColorText" value="#ffffff">
                                </div>
                            </div>

                            <div class="option-group">
                                <label>Resize Mode</label>
                                <select id="resizeMode">
                                    <option value="none">No Resize</option>
                                    <option value="fit">Fit to Smallest</option>
                                    <option value="stretch">Stretch to Match</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Image List -->
                    <div class="image-list" id="imageList">
                        <h3>Images (Click to reorder)</h3>
                        <div class="image-items" id="imageItems"></div>
                    </div>

                    <!-- Preview Area -->
                    <div class="preview">
                        <h3>Stitched Preview</h3>
                        <div class="preview-container">
                            <canvas id="previewCanvas" style="display: none; max-width: 100%;"></canvas>
                            <div id="previewPlaceholder" class="preview-placeholder">
                                <p>No images uploaded yet</p>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button class="action-btn" id="stitchBtn">Stitch Images</button>
                        <button class="action-btn" id="clearBtn">Clear All</button>
                        <a href="#" class="download-btn" id="downloadBtn" style="display: none;">Download Stitched Image</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="../pages/contact.html">Contact Us</a>
                <a href="../pages/privacy.html">Privacy Policy</a>
                <a href="../pages/terms.html">User Rights</a>
            </div>
            <div class="copyright">
                <p>&copy; 2026 OOPEN AII. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const imageUpload = document.getElementById('imageUpload');
            const uploadArea = document.getElementById('uploadArea');
            const directionOptions = document.querySelectorAll('input[name="direction"]');
            const gap = document.getElementById('gap');
            const gapValue = document.getElementById('gapValue');
            const backgroundColor = document.getElementById('backgroundColor');
            const backgroundColorText = document.getElementById('backgroundColorText');
            const resizeMode = document.getElementById('resizeMode');
            const imageItems = document.getElementById('imageItems');
            const previewCanvas = document.getElementById('previewCanvas');
            const previewPlaceholder = document.getElementById('previewPlaceholder');
            const stitchBtn = document.getElementById('stitchBtn');
            const clearBtn = document.getElementById('clearBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            const ctx = previewCanvas.getContext('2d');
            const uploadedImages = [];
            let isDragging = false;
            let dragTarget = null;
            let dragStartX, dragStartY;
            let dragIndex = -1;
            
            // Set up drag and drop
            Utils.setupDragAndDrop(uploadArea, imageUpload, handleFiles);
            
            // Update gap value display
            gap.addEventListener('input', function() {
                gapValue.textContent = `${this.value}px`;
                if (uploadedImages.length > 1) {
                    updatePreview();
                }
            });
            
            // Update background color
            backgroundColor.addEventListener('input', function() {
                backgroundColorText.value = this.value;
                if (uploadedImages.length > 1) {
                    updatePreview();
                }
            });
            
            backgroundColorText.addEventListener('input', function() {
                if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                    backgroundColor.value = this.value;
                    if (uploadedImages.length > 1) {
                        updatePreview();
                    }
                }
            });
            
            // Update direction or resize mode
            directionOptions.forEach(option => {
                option.addEventListener('change', function() {
                    if (uploadedImages.length > 1) {
                        updatePreview();
                    }
                });
            });
            
            resizeMode.addEventListener('change', function() {
                if (uploadedImages.length > 1) {
                    updatePreview();
                }
            });
            
            // Handle file upload
            imageUpload.addEventListener('change', function(e) {
                handleFiles(e.target.files);
            });
            
            function handleFiles(files) {
                if (!files.length) return;
                
                // Reset file input to allow re-uploading the same files
                imageUpload.value = '';
                
                // Process each file
                Array.from(files).forEach(file => {
                    if (!file.type.match('image.*')) {
                        Utils.showNotification('Only image files are supported', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            // Add to uploaded images
                            const imageData = {
                                src: e.target.result,
                                width: img.width,
                                height: img.height,
                                element: null
                            };
                            
                            uploadedImages.push(imageData);
                            
                            // Create image element in the list
                            const imageItem = document.createElement('div');
                            imageItem.className = 'image-item';
                            imageItem.innerHTML = `
                                <img src="${e.target.result}" alt="Uploaded image">
                                <div class="image-item-controls">
                                    <span class="image-index">${uploadedImages.length}</span>
                                    <button class="remove-btn" data-index="${uploadedImages.length - 1}">×</button>
                                </div>
                                <div class="image-info">${img.width}×${img.height}</div>
                            `;
                            
                            imageData.element = imageItem;
                            imageItems.appendChild(imageItem);
                            
                            // Add drag-and-drop sorting
                            setupDragAndDropSorting(imageItem);
                            
                            // Add remove button handler
                            imageItem.querySelector('.remove-btn').addEventListener('click', function() {
                                const index = parseInt(this.dataset.index);
                                removeImage(index);
                            });
                            
                            // Hide placeholder when images are uploaded
                            if (uploadedImages.length > 0) {
                                previewPlaceholder.style.display = 'none';
                                previewCanvas.style.display = 'block';
                            }
                            
                            // Update preview if we have more than one image
                            if (uploadedImages.length > 1) {
                                updatePreview();
                            }
                            
                            Utils.showNotification('Image uploaded successfully!');
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            // Set up drag-and-drop sorting
            function setupDragAndDropSorting(element) {
                element.setAttribute('draggable', true);
                
                element.addEventListener('dragstart', function(e) {
                    isDragging = true;
                    dragTarget = this;
                    dragStartX = e.clientX;
                    dragStartY = e.clientY;
                    dragIndex = parseInt(this.querySelector('.remove-btn').dataset.index);
                    this.classList.add('dragging');
                    
                    // Set data transfer
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', dragIndex);
                });
                
                element.addEventListener('dragend', function() {
                    isDragging = false;
                    dragTarget = null;
                    this.classList.remove('dragging');
                    
                    // Update indices after drag
                    updateImageIndices();
                });
                
                element.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    if (!isDragging || this === dragTarget) return;
                    
                    const rect = this.getBoundingClientRect();
                    const thisIndex = parseInt(this.querySelector('.remove-btn').dataset.index);
                    
                    // Calculate insertion point
                    if (thisIndex > dragIndex) {
                        // Moving down
                        this.parentNode.insertBefore(dragTarget, this.nextSibling);
                    } else {
                        // Moving up
                        this.parentNode.insertBefore(dragTarget, this);
                    }
                });
                
                element.addEventListener('drop', function(e) {
                    e.preventDefault();
                    
                    // Update the array order to match the DOM
                    updateImagesOrder();
                    
                    // Update preview
                    if (uploadedImages.length > 1) {
                        updatePreview();
                    }
                });
            }
            
            // Update image indices
            function updateImageIndices() {
                const items = imageItems.querySelectorAll('.image-item');
                items.forEach((item, index) => {
                    item.querySelector('.image-index').textContent = index + 1;
                    item.querySelector('.remove-btn').dataset.index = index;
                });
            }
            
            // Update the images array order to match DOM
            function updateImagesOrder() {
                const items = imageItems.querySelectorAll('.image-item');
                const newOrder = [];
                
                items.forEach(item => {
                    const index = parseInt(item.querySelector('.remove-btn').dataset.index);
                    newOrder.push(uploadedImages[index]);
                });
                
                // Clear and rebuild uploadedImages array
                uploadedImages.length = 0;
                newOrder.forEach((imgData, index) => {
                    imgData.element.querySelector('.remove-btn').dataset.index = index;
                    uploadedImages.push(imgData);
                });
            }
            
            // Remove an image
            function removeImage(index) {
                // Remove from DOM
                if (uploadedImages[index] && uploadedImages[index].element) {
                    uploadedImages[index].element.remove();
                }
                
                // Remove from array
                uploadedImages.splice(index, 1);
                
                // Update indices
                updateImageIndices();
                
                // Update preview
                if (uploadedImages.length > 1) {
                    updatePreview();
                } else if (uploadedImages.length === 0) {
                    previewPlaceholder.style.display = 'block';
                    previewCanvas.style.display = 'none';
                    downloadBtn.style.display = 'none';
                }
                
                Utils.showNotification('Image removed');
            }
            
            // Update preview
            function updatePreview() {
                if (uploadedImages.length < 2) return;
                
                const direction = document.querySelector('input[name="direction"]:checked').value;
                const gapSize = parseInt(gap.value);
                const bgColor = backgroundColor.value;
                const mode = resizeMode.value;
                
                // Calculate dimensions based on direction
                let canvasWidth = 0;
                let canvasHeight = 0;
                let targetWidth = 0;
                let targetHeight = 0;
                
                // Calculate max dimensions
                if (mode === 'fit') {
                    // Find smallest dimensions
                    targetWidth = Math.min(...uploadedImages.map(img => img.width));
                    targetHeight = Math.min(...uploadedImages.map(img => img.height));
                }
                
                if (direction === 'horizontal') {
                    // Horizontal stitching
                    canvasWidth = uploadedImages.reduce((sum, img) => {
                        if (mode === 'fit') return sum + targetWidth;
                        if (mode === 'stretch') return sum + targetHeight * (img.width / img.height);
                        return sum + img.width;
                    }, 0);
                    canvasWidth += gapSize * (uploadedImages.length - 1);
                    
                    canvasHeight = uploadedImages.reduce((max, img) => {
                        if (mode === 'fit') return targetHeight;
                        if (mode === 'stretch') return targetHeight;
                        return Math.max(max, img.height);
                    }, 0);
                } else {
                    // Vertical stitching
                    canvasHeight = uploadedImages.reduce((sum, img) => {
                        if (mode === 'fit') return sum + targetHeight;
                        if (mode === 'stretch') return sum + targetWidth * (img.height / img.width);
                        return sum + img.height;
                    }, 0);
                    canvasHeight += gapSize * (uploadedImages.length - 1);
                    
                    canvasWidth = uploadedImages.reduce((max, img) => {
                        if (mode === 'fit') return targetWidth;
                        if (mode === 'stretch') return targetWidth;
                        return Math.max(max, img.width);
                    }, 0);
                }
                
                // Set canvas dimensions
                previewCanvas.width = canvasWidth;
                previewCanvas.height = canvasHeight;
                
                // Clear canvas with background color
                ctx.fillStyle = bgColor;
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                
                // Draw images
                let currentX = 0;
                let currentY = 0;
                
                uploadedImages.forEach((imgData, index) => {
                    const img = new Image();
                    img.src = imgData.src;
                    
                    let drawWidth = imgData.width;
                    let drawHeight = imgData.height;
                    let offsetX = 0;
                    let offsetY = 0;
                    
                    if (mode === 'fit') {
                        drawWidth = targetWidth;
                        drawHeight = targetHeight;
                    } else if (mode === 'stretch') {
                        if (direction === 'horizontal') {
                            drawHeight = canvasHeight;
                            drawWidth = drawHeight * (imgData.width / imgData.height);
                        } else {
                            drawWidth = canvasWidth;
                            drawHeight = drawWidth * (imgData.height / imgData.width);
                        }
                    } else {
                        // No resize - center images
                        if (direction === 'horizontal') {
                            offsetY = (canvasHeight - drawHeight) / 2;
                        } else {
                            offsetX = (canvasWidth - drawWidth) / 2;
                        }
                    }
                    
                    ctx.drawImage(img, currentX + offsetX, currentY + offsetY, drawWidth, drawHeight);
                    
                    // Update position for next image
                    if (direction === 'horizontal') {
                        currentX += drawWidth + gapSize;
                    } else {
                        currentY += drawHeight + gapSize;
                    }
                });
            }
            
            // Stitch images button
            stitchBtn.addEventListener('click', function() {
                if (uploadedImages.length < 2) {
                    Utils.showNotification('Please upload at least 2 images', 'error');
                    return;
                }
                
                updatePreview();
                
                // Create download link
                const dataURL = previewCanvas.toDataURL('image/png');
                downloadBtn.href = dataURL;
                downloadBtn.download = 'stitched-image.png';
                downloadBtn.style.display = 'inline-block';
                
                Utils.showNotification('Images stitched successfully!');
            });
            
            // Clear all images
            clearBtn.addEventListener('click', function() {
                // Clear DOM
                imageItems.innerHTML = '';
                
                // Clear array
                uploadedImages.length = 0;
                
                // Show placeholder
                previewPlaceholder.style.display = 'block';
                previewCanvas.style.display = 'none';
                downloadBtn.style.display = 'none';
                
                Utils.showNotification('All images cleared');
            });
            
            // Download button
            downloadBtn.addEventListener('click', function() {
                Utils.showNotification('Stitched image downloaded!');
            });
        });
    </script>
    <style>
        .preview-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            background-color: #f9f9f9;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .preview-placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            color: #999;
            font-size: 18px;
        }
        
        .image-list {
            margin: 20px 0;
        }
        
        .image-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .image-item {
            position: relative;
            width: 120px;
            height: 120px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            background-color: #f5f5f5;
            cursor: move;
            transition: all 0.2s;
        }
        
        .image-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .image-item.dragging {
            opacity: 0.5;
            transform: scale(1.05);
        }
        
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .image-item-controls {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
        }
        
        .image-index {
            font-size: 12px;
            font-weight: bold;
        }
        
        .remove-btn {
            width: 20px;
            height: 20px;
            border: none;
            background-color: transparent;
            color: white;
            font-size: 20px;
            line-height: 1;
            cursor: pointer;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .remove-btn:hover {
            background-color: rgba(255, 0, 0, 0.5);
        }
        
        .image-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 4px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 10px;
            text-align: center;
        }
        
        .direction-buttons {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .direction-buttons label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .direction-label {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 20px;
            border: 1px solid #ddd;
            border-radius: 3px;
            position: relative;
        }
        
        .direction-buttons input[type="radio"]:checked + .direction-label {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .direction-buttons input[type="radio"]:checked + .direction-label::after {
            content: '';
            position: absolute;
            left: 4px;
            top: 4px;
            width: 12px;
            height: 12px;
            background-color: white;
            border-radius: 50%;
        }
        
        .direction-buttons input[type="radio"] {
            display: none;
        }
        
        .color-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .color-input-group input[type="color"] {
            width: 50px;
            height: 36px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .color-input-group input[type="text"] {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .upload-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .option-row {
                flex-direction: column;
            }
            
            .image-items {
                justify-content: center;
            }
            
            .direction-buttons {
                justify-content: center;
            }
            
            .color-input-group {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-wrap: wrap;
                gap: 10px;
            }
        }
    </style>
</body>
</html>